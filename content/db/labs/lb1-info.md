---
title: Доп теоретия к лабое 1
draft: false
tags:
  - 4o
---

>[!warning] В разработке
>Соре 2 ночи

# Основа

## `DISTINCT` или Как отфильтровать дубликаты?

Один из частых вопросов, возникающих при работе с базами данных: как выбрать уникальные значения из таблицы? В SQL для этого существует ключевое слово `DISTINCT`.

#### Что такое DISTINCT?

Команда `DISTINCT` используется в SQL-запросах для того, чтобы убрать дубликаты из результатов. Она позволяет выводить только уникальные строки, где значения в указанных полях не повторяются.

#### Как работает DISTINCT?

Когда вы делаете выборку из таблицы, по умолчанию SQL возвращает все строки, которые соответствуют вашему запросу, включая дубликаты. `DISTINCT` исключает повторяющиеся строки, оставляя только одну строку для каждого уникального значения.

#### Пример 1: Уникальные значения одного столбца

Допустим, у нас есть таблица `employees` с информацией о сотрудниках:

| id  | name     | department |
|-----|----------|------------|
| 1   | Alice    | HR         |
| 2   | Bob      | IT         |
| 3   | Charlie  | HR         |
| 4   | David    | IT         |
| 5   | Eve      | Marketing  |

Если мы хотим узнать, в каких отделах работают сотрудники, и нам нужны только уникальные отделы, можно использовать `DISTINCT`:

```sql
SELECT DISTINCT department
FROM employees;
```

Результат:

| department |
|------------|
| HR         |
| IT         |
| Marketing  |

Здесь мы видим, что `DISTINCT` убрал дубликаты и вернул только уникальные значения в столбце `department`.

#### Пример 2: Уникальные значения нескольких столбцов

Что, если нам нужно вывести не только уникальные отделы, но и уникальные комбинации имени сотрудника и его отдела? Тогда `DISTINCT` можно использовать для нескольких столбцов одновременно.

```sql
SELECT DISTINCT name, department
FROM employees;
```

Результат:

| name     | department |
|----------|------------|
| Alice    | HR         |
| Bob      | IT         |
| Charlie  | HR         |
| David    | IT         |
| Eve      | Marketing  |

Каждая строка здесь уникальна, потому что комбинации значений в столбцах `name` и `department` не повторяются.

#### Важные моменты:

1. `DISTINCT применяется ко всей строке`. Если вы укажете несколько столбцов, он будет искать уникальные комбинации значений в этих столбцах.
2. **Порядок данных** не гарантируется. Чтобы гарантировать определенный порядок результатов, используйте `ORDER BY` в запросе.

#### Пример 3: DISTINCT и ORDER BY

Если вам нужно получить уникальные значения и отсортировать их, например, по имени, можно добавить `ORDER BY`:

```sql
SELECT DISTINCT department
FROM employees
ORDER BY department ASC;
```

Результат будет таким же, как в первом примере, но отделы будут отсортированы в алфавитном порядке.

#### Когда использовать DISTINCT?

- Когда вам нужно исключить дублирующиеся значения из результата.
- Когда вам важны только уникальные комбинации данных.

#### Когда не использовать DISTINCT?

- Если вам нужны все данные, включая дубликаты.
- Когда можно решить задачу с помощью других операторов, например, `GROUP BY`.

В следующих разделах мы рассмотрим другие полезные SQL-инструменты, такие как `SUBSTRING`, `EXTRACT`, `GROUP BY`, `JOIN`, и `HAVING`, которые помогут делать запросы еще более гибкими и мощными!

## `SUBSTRING` -- Извлечение части строки

Иногда при работе с текстовыми данными нужно получить только часть строки. В SQL для этого используется функция `SUBSTRING`. Она позволяет извлечь фрагмент текста из строки по указанным позициям.

#### Что такое SUBSTRING?

`SUBSTRING` — это SQL-функция, которая возвращает подстроку (часть строки) из текстового поля. С её помощью можно извлекать символы начиная с определенной позиции и до нужной длины.

#### Синтаксис SUBSTRING

```sql
SUBSTRING(string FROM start FOR length)
```

- `string` — строка или столбец, из которого нужно извлечь подстроку.
- `start` — позиция, с которой начинается извлечение (начинается с 1).
- `length` — количество символов, которые нужно извлечь.

#### Пример 1: Извлечение первых символов

Допустим, у нас есть таблица `products`, где хранятся названия товаров:

| id  | name         |
|-----|--------------|
| 1   | Bicycle      |
| 2   | Scooter      |
| 3   | Skateboard   |

Если нам нужно получить первые три символа названия каждого товара, можно использовать `SUBSTRING`:

```sql
SELECT name, SUBSTRING(name FROM 1 FOR 3) AS short_name
FROM products;
```

Результат:

| name       | short_name |
|------------|------------|
| Bicycle    | Bic        |
| Scooter    | Sco        |
| Skateboard | Ska        |

В данном примере мы извлекаем по три символа, начиная с первого символа строки.

#### Пример 2: Извлечение символов с произвольной позиции

`SUBSTRING` позволяет извлекать символы не только с начала строки. Например, если нужно извлечь три символа, начиная с четвертого символа, можно сделать так:

```sql
SELECT name, SUBSTRING(name FROM 4 FOR 3) AS middle_part
FROM products;
```

Результат:

| name       | middle_part |
|------------|-------------|
| Bicycle    | ycl         |
| Scooter    | ote         |
| Skateboard | teb         |

#### Пример 3: Извлечение до конца строки

Если нужно извлечь часть строки до её конца, можно не указывать длину:

```sql
SELECT name, SUBSTRING(name FROM 4) AS rest_of_name
FROM products;
```

Результат:

| name       | rest_of_name |
|------------|--------------|
| Bicycle    | cycle        |
| Scooter    | ooter        |
| Skateboard | teboard      |

Здесь мы начинаем извлечение с четвертого символа и до конца строки.

#### Пример 4: SUBSTRING с WHERE

`SUBSTRING` также можно использовать в условиях `WHERE`. Например, чтобы найти товары, у которых третий символ — буква «k»:

```sql
SELECT name
FROM products
WHERE SUBSTRING(name FROM 3 FOR 1) = 'k';
```

Результат:

| name       |
|------------|
| Skateboard |

#### Когда использовать SUBSTRING?

- Когда нужно извлечь часть строки, например, первые несколько символов.
- Когда нужно анализировать текст, например, проверять наличие определённых символов в конкретной позиции.
- Для обработки строковых данных, таких как коды товаров, имена или адреса.

#### Полезные советы:

1. `SUBSTRING` — мощный инструмент для работы с текстовыми данными, но не забывайте про производительность. Обработка больших объемов текстовых данных с использованием подстрок может замедлить запросы.
2. Если вам нужно извлечь фиксированные части строк в таблице, лучше использовать `SUBSTRING`, чем переписывать данные вручную.

Теперь вы знаете, как извлекать части строк с помощью `SUBSTRING`. В следующем разделе мы рассмотрим, как использовать `EXTRACT` для работы с датами!

# Доп инфа
>[!tip] Эм
>Дальнейшие функции не упоминались в методичке напрямую и не требовались для выполнения [[lab-1|лабы 1]]

## `SIMILAR TO` -- Работа с шаблонами и регулярными выражениями

Оператор `SIMILAR TO` в SQL используется для проверки, соответствует ли строка определённому шаблону, основанному на регулярных выражениях. Его синтаксис схож с оператором `LIKE`, однако `SIMILAR TO` поддерживает более сложные шаблоны, приближенные к SQL-совместимым регулярным выражениям.

##### Синтаксис:

```sql
строка SIMILAR TO шаблон [ESCAPE спецсимвол]
строка NOT SIMILAR TO шаблон [ESCAPE спецсимвол]
```

- **строка** — строка, которая проверяется.
- **шаблон** — регулярное выражение SQL, которому должна соответствовать строка.
- **`ESCAPE` спецсимвол** — необязательный символ, который используется для экранирования метасимволов.

##### Пример использования:

```sql
SELECT 'abc' SIMILAR TO 'abc';        -- true
SELECT 'abc' SIMILAR TO 'a';          -- false
SELECT 'abc' SIMILAR TO '%(b|d)%';    -- true
SELECT 'abc' SIMILAR TO '(b|c)%';     -- false
```

#### Как работает SIMILAR TO?

`SIMILAR TO` возвращает `true` или `false`, в зависимости от того, соответствует ли строка заданному шаблону. В отличие от обычных регулярных выражений, шаблон должен соответствовать всей строке, а не её части. Также `SIMILAR TO` поддерживает метасимволы из оператора `LIKE`:

- `_` — любой одиночный символ.
- `%` — любая подстрока.

#### Метасимволы SIMILAR TO

Кроме стандартных символов подстановки, `SIMILAR TO` поддерживает следующие метасимволы из регулярных выражений POSIX:

| Метасимвол | Описание |
|------------|----------|
| `\|`        | Альтернатива, выбор одного из двух вариантов. |
| `*`        | Повторение предыдущего элемента 0 и более раз. |
| `+`        | Повторение предыдущего элемента 1 и более раз. |
| `?`        | Вхождение предыдущего элемента 0 или 1 раз. |
| `{m}`      | Повторение предыдущего элемента ровно `m` раз. |
| `{m,}`     | Повторение предыдущего элемента `m` и более раз. |
| `{m,n}`    | Повторение предыдущего элемента от `m` до `n` раз. |
| `()`       | Группировка элементов. |
| `[]`       | Класс символов (как в обычных регулярных выражениях). |

#### Пример:

```sql
SELECT 'foobar' SIMILAR TO 'foo%' ESCAPE '#';  -- true
SELECT 'foobar' SIMILAR TO 'f[a-z]+r';        -- true
```

#### Особенности:

- Точка (`.`) `не` является метасимволом в `SIMILAR TO`, в отличие от POSIX-совместимых регулярных выражений.
- Как и в случае с `LIKE`, обратная косая черта (`\`) экранирует специальные символы, а предложение `ESCAPE` позволяет использовать другой символ для экранирования.

#### Пример использования ESCAPE:

```sql
SELECT '20% discount' SIMILAR TO '20#%%' ESCAPE '#';  -- true
```

Здесь символ `%` экранирован с помощью символа `#`.

#### Функция SUBSTRING с регулярными выражениями

Функция `SUBSTRING` позволяет извлекать подстроку, соответствующую регулярному выражению SQL. Подстрока извлекается по аналогии с оператором `SIMILAR TO`.

##### Пример использования SUBSTRING:

```sql
SELECT SUBSTRING('foobar' FROM '%#"o_b#"%' FOR '#');  -- oob
```

Здесь используется шаблон с маркерами `#"` и `"#"` для обозначения извлекаемой части строки.

## EXTRACT

## GROUP BY

## JOIN

## HAVING